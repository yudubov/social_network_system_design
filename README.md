### System Design социальной сети для курса по System Design

### Функциональные требования 
• Назначение системы - социальная сеть для путешественников
• Требуется разработать веб-версию и мобильную версия системы
• Отчеты и аналитика не требуются
• Основные сущности системы, которыми управляет пользователь: пост, реакция, комментарий
• Просмотр постов пользователей доступен, в обратном хронологическом порядке 
• Система должна предоставлять возможность поиска популярных мест для путешествий. (фильтрация постов пользователей по справочникам стран, городов и выдача результатов)
• Основные сущности системы, которыми управляет пользователь: пост, реакция, комментарий, подписки/отписки
• Функции системы с основными сущностями:
1. (запись - пост) создание и публикация поста: 
- до 6 фотографий с максимальным размером 500Кб
- описание до 250 символов 
- указание в посте страны и города путешествия (выбор из заранее предпоготовленных справочников стран и городов)   
2. (чтение - постов) просмотр постов пользователя (своих), в обратном хронологическом порядке 
3. (чтение - постов) просмотр постов других пользователей, в обратном хронологическом порядке

4. (запись - комментарий) создание комментария до 500 символов
5. (чтение - комментарий) возможность ознакомления с комментариями других пользователей о постах пользователя

6. (запись - реакция) оценка поста другого пользователя
7. (чтение - реакция) просмотр оценок своих постов

8. (запись - подписка/отписка) возможность подписываться/отписывать от других пользователей
9. (чтение - подписка/отписка) возможность ознакамливаться со списком подписчиков пользователя



### Нефункциональные требования
• Сезонность - активность пользователей на 50% возрастает в летнее время
• Низкий сезон DAU 10 000 000 (зима, весна, осень)
• Высокий сезон DAU 15 000 000 (летнее время)
• Аудитория СНГ
• Условия хранения данных по постам: 
- данные давностью менее 1 года должны подгружаться в системе <=2 секунд
- данные давностью более 1 года должны подгружаться в системе <=5 секунд
• Уровень доступности системы - 99,9% времени (допускается 9 часов в год недоступности системы)
• Вся история постов пользователей, комментарии, реакции хранятся в системе и доступны к просмотру
• Активности пользователей
Посты:
1. (запись - пост) в среднем каждый пользователь публикует 1 пост в день
2. (чтение - постов) в среднем каждый пользователь просматривает ленту своих постов 1 раз в день, со средней глубиной просмотра 10 постов 
3. (чтение - постов) в среднем каждый пользователь просматривает 50 постов других пользователей в день

Комментарии:
4. (запись - комментарий) в среднем каждый пользователь пишет по 5 комментариев к другим постам в день
5. (чтение - комментарий) в среднем каждый пользователь просматривает 5 новых коментариев в день

Реакции:
6. (запись - реакция) в среднем каждый пользователь оценивает 50 постов других пользователей в день
7. (чтение - реакция) в среднем каждый пользователь ознкамливается с 10 новыми оценками своих постов в день

Подписки/отписки:
8. (запись - подписки) в среднем каждый пользователь подписывается на других пользователей, для отслеживания их активности 1 раз в день
9. (запись - отписки) в среднем каждый пользователь отписывается от других пользователей 0,2 раза в день
10. (чтение - подписки/отписки) в среднем каждый пользователь ознакамливается со списком своих подписчиков 2 раза в день

• Лимиты 
Пользователь может писать не более 500 комментариев в день к другим постам
Пользователь может публиковать не более 20 своих постов в день
Пользователь может просматривать не более 2000 постов других пользователей в день
Пользователь может оценивать не более 500 постов в день
Пользователь может подписывать не более чем на 500 других пользователей в день


### Оценка весов
• Оценка веса поста:
author_user_id - 20 байт
post_id - 20 байт
created_at - 10 байт
title - 100 байт
comment - 500 байт
city - 5 байт
country - 5 байт
foto - 3072000 байт
hashtag - 100 байт
Вес поста = 3072760 байт / округлим до 3Мб

• Оценка веса комментария:
author_user_id - 20 байт
commentator_user_id - 20 байт
post_id - 20 байт
created_at - 10 байт
comment - 1000 байт
Вес комментария = 1070 байт / округлим до 1 кб

• Оценка веса реакции:
author_user_id - 20 байт
commentator_user_id - 20 байт
post_id - 20 байт
created_at - 10 байт
estimate - 5 байт
Вес реакции = 80 байт / округлим до 100 байт 

• Оценка веса подписки/отписки:
user_id - 20 байт
subscriber_user_id - 20 байт
created_at - 10 байт
is_subscription - 5 байт
Вес подписки/отписки = 55 байт  



### Оценка RPS - низкого сезона (летний сезон +50%):
• RPS посты 
Пользователь публикует 1 пост в день
RPS – write = 10 000 000 * 1 / 100 000 = 100

Пользователь читает 10 своих постов и 50 постов других пользователей
RPS – read = 10 000 000 * 60 / 100 000 = 6 000


• RPS комментарии 
Пользователь пишет 5 комментариев в день
RPS – write = 10 000 000 * 5 / 100 000 = 500

Пользователь читает 5 комментариев в день
RPS – read = 10 000 000 * 5 / 100 000 = 500


• RPS реакции 
Пользователь оценивает 50 постов других пользователей в день
RPS – write = 10 000 000 * 50 / 100 000 = 5 000

Пользователь ознкамливается с 10 новыми оценками своих постов
RPS – read = 10 000 000 * 10 / 100 000 = 1 000


• RPS подписки/отписки 
Пользователь подписывает 1 раз в день и отписывается 0,2 раза в день
RPS – write = 10 000 000 * 1,2 / 100 000 = 120

Пользователь ознакамливается со списком своих подписчиков 2 раза в день
RPS – read = 10 000 000 * 2 / 100 000 = 200 


### Оценка трафика
• Traffic посты 
100 RPS весом 3Мб 
Traffic – write = 100 * 3 = 300 Мб/c

6000 RPS весом 3Мб 
Traffic – read = 6000 * 3 = 18 000 Mб/c


• Traffic комментарии 
500 RPS весом 1 кб 
Traffic – write = 500 * 1 = 500 кб/c

500 RPS весом 1 кб 
Traffic – read = 500 * 1 = 500 кб/c 


• Traffic реакции 
5 000 RPS весом 100 байт
Traffic – write = 5 000 * 100 = 500 000 байт/c - округлим до 500 кб/c  

1 000 RPS весом 100 байт
Traffic – read = 1 000 * 100 = 100 000 байт/c - округлим до 100 кб/c  


• Traffic подписки/отписки 
120 RPS весом 55 байт 
Traffic – write = 120 * 55 = 6 600 байт/c - округлим до 7 кб/c 

200 RPS весом 55 байт  
Traffic – read = 200 * 55 = 11 000 байт/c - округлим до 11 кб/c 


### Расчет одновременных соединений - низкого сезона (летнее сезон +50%):
Connections = 10 000 000 * 0.1 = 1 000 000 


### Вывод: 
Самая большая операция по RPS и трафику: чтение постов (6000 RPS, 18 000 Mб/c)
Приложение заточено больше на операцию чтение 
